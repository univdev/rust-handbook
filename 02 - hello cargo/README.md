# Cargo

Cargo는 Rust 생태계의 빌드 시스템 및 패키지 매니저입니다.  
Rust역시 다른 언어와 마찬가지로 프로그램을 제작하기 위해 여러 의존성을 필요로 하는 상황이 발생합니다.  
Cargo는 이런 상황에서 여러분의 프로젝트에 이미 개발 된 의존성을 추가 하거나 정의 된 의존성을 설치하게 해주는 여러 작업을 도와줍니다.

Cargo는 의존성을 관리할 뿐 아니라 작성 된 Rust 프로그램을 컴파일 및 빌드 하는 작업을 수행 해줍니다.  
01 섹션에서 Hello world 프로그램을 빌드 했다면 이미 Cargo를 이용한 적이 있는 것입니다.

## Cargo 설치 여부 확인

```sh
cargo --version
```

명령어를 이용하여 내 컴퓨터에 Cargo가 설치 되었는지 확인할 수 있습니다.  
만약 설치 되지 않았다면(없는 명령어라고 뜬다면) Rust를 설치했던 방식에서 Cargo를 어떻게 설치하는지 별도로 알아보고 설치 해주셔야 합니다.

## Cargo 프로젝트 시작하기

우리는 01 섹션에서 Hello world 프로그램을 간단하게 작성해 본 적이 있습니다.  
이제 Cargo를 통해서 조금 더 구조화 된 Hello world 프로그램을 경험해 볼 차례입니다.

```sh
cargo new hello_cargo --bin
```

명령어를 실행하면 `hello_cargo` 디렉토리가 생성 된 것을 볼 수 있습니다. (이 레포지토리에서는 02 섹션 하위에 이미 존재합니다.)  
`src` 폴더와 `Cargo.toml` 파일이 추가로 생성이 되었는데, 많은 프로젝트에서 `src` 폴더는 실제 프로그램의 소스파일을 배치하는 폴더로 사용합니다.  
실제로 내부 파일을 보면 `main.rs` 라는 파일에 Hello world 프로그램이 작성 되어 있는 것을 볼 수 있습니다.

`Cargo.toml` 파일을 열어보면 매우 간단한 프로젝트 명세가 작성 되어 있습니다.

```toml
[package]
name = "hello_cargo"
version = "0.1.0"
edition = "2024"

[dependencies]
```

`[package]` 항목 아래에 적힌 값은 해당 프로젝트를 설명하는 프로퍼티입니다.  
`[dependencies]` 항목 아래에는 아무런 값도 적혀있지 않으나, 앞으로 Rust를 이용하여 복잡한 프로그램을 개발하게 되면 해당 프로젝트에서 사용하는 의존성이 아래에 작성되게 됩니다.

> Rust 진영에서는 이러한 의존성을 'Crate(크레이트)'라고 부릅니다.

Cargo는 `Cargo.toml` 문서를 바탕으로 프로그램을 빌드하거나 연관 된 패키지를 내려받는 것을 도와줍니다.

## Cargo를 이용하여 프로젝트 컴파일하기

```sh
cargo build
```

명령어를 `Cargo.toml` 파일이 있는 폴더에서 실행하게 되면 프로젝트가 컴파일 되어 `target` 폴더 및 `Cargo.lock` 파일이 생겨나게 됩니다.  
`target` 폴더 안에는 조금 더 복잡한 구조의 파일이 존재하지만 현재는 알 필요 없으니 생략합니다.  
`Cargo.lock` 파일도 마찬가지로 생략합니다.

> 다만 빌드 된 결과물이 `target/debug` 폴더 안에 생성 된다는 사실은 알아두면 좋습니다.

### 컴파일이 가능한 상태인지 확인하기

현재 작성 된 Rust 프로그램이 잘못 작성 되어 있거나, 없는 의존성을 참조하는 코드가 작성 되어 있는 등 프로그램을 컴파일 할 수 없는 상황인지 확인하려면

```sh
cargo check
```

명령어를 수행하면 됩니다.  
이 명령어는 실제로 컴파일 작업을 수행하지 않고 가능 여부만을 체크합니다.

## Cargo를 이용하여 프로젝트 실행하기

컴파일을 완료한 상태에서 바이너리 파일을 실행하려면

```sh
cargo run
```

명령어를 컴파일 당시 폴더에서 그대로 실행하면 Cargo가 해당 프로젝트의 폴더에서 바이너리 파일을 찾아내 실행하게 됩니다.

만약 `build`를 진행하지 않고 `run` 명령어를 바로 실행하게 되면 자동으로 컴파일 과정을 수행한 뒤 실행하게 됩니다.

## 릴리즈 빌드

위에서 따로 용어 설명을 하지 않아서 '바이너리를 만드는 작업'을 컴파일로 뭉뚱 그려서 설명했지만 실제로는 '컴파일'과 '빌드'는 다른 뜻을 가지고 있습니다.

- 컴파일: 특정 프로그래밍 언어로 작성 된 프로그램을 기계어로 번역하는 작업
- 빌드: 그렇게 번역 된 코드를 실제 실행 가능한 바이너리 파일로 만드는 작업

이제 용어 설명도 했으니 '실행 가능한 파일을 만드는 작업'을 컴파일 대신 빌드라고 표현하겠습니다.

Cargo를 이용한 빌드에는 두가지가 있습니다.

- Debug 빌드
- Release 빌드

우리가 `cargo build` 명령어를 통해 프로젝트를 빌드하면 `debug`라고 명명 된 폴더에 저장되는게 신경쓰이지 않으셨나요?

Release 빌드는 Debug 빌드와는 다르게 실제 사용자에게 배포 되는 파일을 빌드하는 작업입니다.  
그렇기에 조금 더 최적화가 된 바이너리 파일을 추출하게 됩니다.  
최적화 작업을 빡세게 수행하니 실제 빌드 시간이 더 길어지게 되기에 Release 빌드와 Debug 빌드를 분기한 것입니다.

```sh
cargo build --release
```

명령어로 Release 빌드를 수행할 수 있습니다.

실제로 두 명령어로 빌드 된 바이너리 파일의 사이즈를 비교하면

- Debug 빌드: `441kb`
- Release 빌드: `430kb`

로 용량 차이가 나는걸 확인할 수 있습니다.  
Hello world 수준의 프로그램이라도 최적화 할 부분은 있다는거네요
